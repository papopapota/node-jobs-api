# ğŸ’¼ Jobs API

![Node.js](https://img.shields.io/badge/Node.js-v18-green.svg)
![Express](https://img.shields.io/badge/Express.js-Backend-lightgrey.svg)
![MongoDB](https://img.shields.io/badge/MongoDB-Database-green.svg)
![Docker](https://img.shields.io/badge/Docker-Enabled-blue.svg)
![CI/CD](https://img.shields.io/badge/CI%2FCD-GitHub%20Actions-orange.svg)
![AWS](https://img.shields.io/badge/Deployment-AWS%20EC2-yellow.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

Jobs API es una **API RESTful** para la gestiÃ³n de ofertas de trabajo, diseÃ±ada con buenas prÃ¡cticas de backend, seguridad y **DevOps profesional**.  
El proyecto incluye autenticaciÃ³n JWT, documentaciÃ³n con Swagger, despliegue automatizado con Docker y GitHub Actions, y versionado automÃ¡tico basado en Git tags.

---

## ğŸš€ CaracterÃ­sticas Principales

### ğŸ” AutenticaciÃ³n y Seguridad
- Registro y login de usuarios con validaciÃ³n
- Hashing de contraseÃ±as con **bcrypt**
- AutenticaciÃ³n con **JWT (JSON Web Tokens)**
- ProtecciÃ³n de rutas privadas con middleware
- Rate limiting contra ataques de fuerza bruta
- Headers de seguridad configurados con Helmet
- ProtecciÃ³n contra XSS con xss-clean
- CORS configurado para orÃ­genes especÃ­ficos

### ğŸ§‘â€ğŸ’¼ GestiÃ³n de Trabajos (CRUD Completo)
- Crear ofertas de trabajo con validaciones
- Listar trabajos con filtros y paginaciÃ³n
- Actualizar trabajos (solo propietario)
- Eliminar trabajos (solo propietario)
- Validaciones de datos con express-validator
- Control de ownership (usuario solo modifica sus trabajos)

### ğŸ›¡ï¸ Seguridad y Robustez
- Middleware de manejo de errores centralizado
- Errores personalizados por tipo (NotFoundError, BadRequestError, etc.)
- Logging estructurado en producciÃ³n
- Variables de entorno para configuraciÃ³n sensible
- ValidaciÃ³n de entrada en todos los endpoints

### ğŸ³ DevOps y Despliegue
- **DockerizaciÃ³n completa** con multi-stage builds
- **Docker Compose v2** para orquestaciÃ³n local
- **Nginx** como reverse proxy con configuraciÃ³n optimizada
- **GitHub Actions** para CI/CD automatizado
- **Despliegue en AWS EC2** con Ubuntu
- **Healthchecks** automÃ¡ticos para validaciÃ³n de despliegues
- **Versionado semÃ¡ntico** automatizado con npm version

---

## ğŸ“ Estructura del Proyecto

```
jobs-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/     # LÃ³gica de negocio
â”‚   â”œâ”€â”€ routes/          # Endpoints de la API
â”‚   â”œâ”€â”€ models/          # Modelos de Mongoose
â”‚   â”œâ”€â”€ middleware/      # Auth y manejo de errores
â”‚   â”œâ”€â”€ errors/          # Errores personalizados
â”‚   â””â”€â”€ db/             # ConexiÃ³n a MongoDB
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ nginx.conf      # ConfiguraciÃ³n de Nginx
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ nginx.conf      # Config para Docker
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/      # GitHub Actions
â”œâ”€â”€ swagger.yaml        # DocumentaciÃ³n Swagger
â”œâ”€â”€ app.js             # Entrada principal
â”œâ”€â”€ server.js          # ConfiguraciÃ³n del servidor
â”œâ”€â”€ docker-compose.yml # OrquestaciÃ³n de servicios
â”œâ”€â”€ Dockerfile         # ConfiguraciÃ³n Docker
â”œâ”€â”€ package.json
â””â”€â”€ .env.example       # Variables de entorno ejemplo
```

---

## âš™ï¸ InstalaciÃ³n Local

### 1ï¸âƒ£ Clonar el repositorio
```bash
git clone https://github.com/tu-usuario/jobs-api.git
cd jobs-api
```

### 2ï¸âƒ£ Configurar variables de entorno
```bash
cp .env.example .env
```
Editar el archivo `.env` con tus valores:

```env
MONGO_URI=mongodb+srv://<user>:<password>@cluster.mongodb.net/jobs-api
JWT_SECRET=super_secret_key_cambiar_en_produccion
JWT_LIFETIME=30d
PORT=3000
NODE_ENV=development

```

### 3ï¸âƒ£ Instalar dependencias
```bash
npm install
```

### 4ï¸âƒ£ Ejecutar en desarrollo
```bash
npm run dev
```
El servidor se iniciarÃ¡ en `http://localhost:3000`

---

## ğŸ³ EjecuciÃ³n con Docker

### Usando Docker Compose (recomendado)
```bash
docker compose up -d
```

### Servicios incluidos:
- **API Node.js** - Puerto 3000
- **Nginx (reverse proxy)** - Puerto 80
- **MongoDB** - Puerto 27017 (si usas MongoDB local)

### Comandos Docker Ãºtiles:
```bash
# Ver logs
docker compose logs -f

# Detener servicios
docker compose down

# Reconstruir imÃ¡genes
docker compose up -d --build

# Ver estado de contenedores
docker compose ps
```

---

## ğŸ“š DocumentaciÃ³n API (Swagger)

La documentaciÃ³n interactiva estÃ¡ disponible en:

### Desarrollo:
```
http://localhost:3000/api/v1/docs
```

### ProducciÃ³n (con Nginx):
```
http://<tu-dominio-o-ip>/api/v1/docs
```

La documentaciÃ³n incluye:
- Todos los endpoints disponibles
- Esquemas de request/response
- Ejemplos de uso
- Posibilidad de probar endpoints directamente

---

## ğŸ” Flujo CI/CD

### ğŸ”– Versionado SemÃ¡ntico
```bash
# Incrementar versiÃ³n
npm version patch   # 1.0.0 â†’ 1.0.1
npm version minor   # 1.0.1 â†’ 1.1.0
npm version major   # 1.1.0 â†’ 2.0.0

# Subir cambios y tags
git push origin main
git push origin --tags
```

### âš™ï¸ Pipeline AutomÃ¡tico (GitHub Actions)
1. **Push a main** o **nuevo tag** dispara el pipeline
2. **Tests** - Ejecuta suite de pruebas
3. **Build** - Construye imagen Docker
4. **Push to Registry** - Sube a Docker Hub
5. **Deploy** - Conecta via SSH a AWS EC2
6. **Health Check** - Valida que la API responde
7. **Rollback** - Si falla, revierte al estado anterior

---

## ğŸ©º Health Check

### Endpoint de salud:
```bash
GET /health
```

### Respuesta esperada:
```json
{
  "status": "ok",
  "timestamp": "2024-01-15T10:30:00Z",
  "version": "1.0.0",
  "uptime": "5 days",
  "database": "connected"
}
```

### VerificaciÃ³n manual:
```bash
curl http://localhost:3000/health
```

El health check previene despliegues defectuosos en producciÃ³n.

---

## ğŸ” Endpoints Principales

### ğŸ”‘ AutenticaciÃ³n
| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| POST | `/api/v1/auth/register` | Registro de nuevo usuario |
| POST | `/api/v1/auth/login` | Inicio de sesiÃ³n (obtiene JWT) |

### ğŸ’¼ Trabajos (Requieren JWT)
| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| GET | `/api/v1/jobs` | Listar todos los trabajos del usuario |
| GET | `/api/v1/jobs/:id` | Obtener trabajo especÃ­fico |
| POST | `/api/v1/jobs` | Crear nuevo trabajo |
| PATCH | `/api/v1/jobs/:id` | Actualizar trabajo existente |
| DELETE | `/api/v1/jobs/:id` | Eliminar trabajo |

### ğŸ“Š Ejemplo de Request:
```bash
# Obtener trabajos (con JWT)
curl -X GET http://localhost:3000/api/v1/jobs \
  -H "Authorization: Bearer tu_token_jwt_aqui"

# Crear trabajo
curl -X POST http://localhost:3000/api/v1/jobs \
  -H "Authorization: Bearer tu_token_jwt_aqui" \
  -H "Content-Type: application/json" \
  -d '{
    "company": "Tech Corp",
    "position": "Backend Developer",
    "status": "pending",
    "jobType": "full-time",
    "jobLocation": "Remote"
  }'
```

---

## ğŸ“¦ GestiÃ³n de Versiones en ProducciÃ³n

### Verificar versiÃ³n desplegada:
```bash
# Ver contenedores en ejecuciÃ³n
docker ps

# Inspeccionar imagen especÃ­fica
docker inspect <container_id> | grep -A2 "Image"

# Ver logs de despliegue
docker logs <container_id>
```

### Comandos de gestiÃ³n:
```bash
# Listar todas las imÃ¡genes disponibles
docker images

# Ver historial de una imagen
docker history <image_name>

# Limpiar recursos no usados
docker system prune -a
```

### Rollback manual:
```bash
# Si necesitas revertir a versiÃ³n anterior
docker pull tu-usuario/jobs-api:<version_anterior>
docker stop jobs-api-container
docker run -d --name jobs-api-container \
  -p 3000:3000 \
  tu-usuario/jobs-api:<version_anterior>
```

---

## ğŸ§ª Testing

```bash
# Ejecutar tests
npm test

# Tests con cobertura
npm run test:coverage

# Tests en watch mode
npm run test:watch
```

---

## ğŸ”§ Variables de Entorno Requeridas

| Variable | DescripciÃ³n | Ejemplo |
|----------|-------------|---------|
| `MONGO_URI` | URI de conexiÃ³n a MongoDB | `mongodb+srv://user:pass@cluster.mongodb.net/db` |
| `JWT_SECRET` | Secreto para firmar JWT | `mi_secreto_super_seguro` |
| `JWT_LIFETIME` | DuraciÃ³n del token JWT | `30d` |
| `PORT` | Puerto de la aplicaciÃ³n | `3000` |
| `NODE_ENV` | Entorno de ejecuciÃ³n | `production` |


---

## ğŸ¤ Contribuir

1. Fork del proyecto
2. Crear rama de feature (`git checkout -b feature/amazing-feature`)
3. Commit de cambios (`git commit -m 'Add amazing feature'`)
4. Push a la rama (`git push origin feature/amazing-feature`)
5. Abrir Pull Request

### Convenciones de cÃ³digo:
- Usar ESLint y Prettier configurados
- Escribir tests para nuevas funcionalidades
- Actualizar documentaciÃ³n (README y Swagger)
- Seguir commits convencionales

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la Licencia MIT. Ver el archivo [LICENSE](LICENSE) para mÃ¡s detalles.

---

## ğŸ‘¥ Autor

Papopapota - [@papopapota](https://github.com/papopapota)

## ğŸ”— Enlaces

- [Repositorio](https://github.com/papopapota/jobs-api)
- [Issues](https://github.com/papopapota/jobs-api/issues)
- [Docker Hub](https://hub.docker.com/r/papopapota/jobs-api)

---

*Ãšltima actualizaciÃ³n: Enero 2025*